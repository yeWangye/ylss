<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<style type="text/css">
			html,
			body {
				overflow: hidden;
				margin: 0;
			}
			
			#allmap {
				position: relative;
				width: 100%;
				overflow: hidden;
				height: 100px;
				margin: 0;
				font-family: "微软雅黑";
				transition: height 1s;
				-moz-transition: height 1s;
				-webkit-transition: height 1s;
				-o-transition: height 1s;
			}
		</style>
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=h7FmYfal3X1emsR59G29XPXbACQGhyw4"></script>
		<title>map</title>
	</head>

	<body>
		<div id="allmap">

		</div>

	</body>

</html>
<script src="js/mui.min.js"></script>
<script type="text/javascript">
	window.onload = function() {

	}
	var map = new BMap.Map("allmap");
	var point = new BMap.Point(116, 40);
	map.centerAndZoom(point, 13);

	var geolocation = new BMap.Geolocation();
	var rPoint = null;
	var mkTemp = null;

	function drawMap(msg) {
		// 百度地图API功能
		if(rPoint) {
			map.addOverlay(mkTemp);
			map.panTo(rPoint);
		} else {
			geolocation.getCurrentPosition(function(r) {
				if(this.getStatus() == BMAP_STATUS_SUCCESS) {

					var myIcon = new BMap.Icon("images/ylss/orientationicon.png", new BMap.Size(30, 30));
					var mk = new BMap.Marker(r.point, {
						icon: myIcon
					});
//					mk.setAnimation(BMAP_ANIMATION_BOUNCE);
					var label = new BMap.Label(msg, {
						offset: new BMap.Size(-60, -10)
					});
					label.setStyle({
						display:"block",
						color: "red",
						fontSize: "12px",
						lineHeight: "25px",
						padding:"10px",
						textAlign: "center",
						zIndex:"1000",
						fontFamily: "微软雅黑"
					});
					if(msg){
						mk.setLabel(label);
					}
					
					localStorage.setItem("longitude", r.point.lng);
					localStorage.setItem("latitude", r.point.lat);
					
					
					map.addOverlay(mk);
					map.panTo(r.point);
					rPoint = r.point;
					mkTemp = mk;
				} else {
					alert('failed' + this.getStatus());
				}
			}, {
				enableHighAccuracy: true
			})
		}

	}

	function setMap(num) {
		document.getElementById("allmap").style.height = num + "px";
		//		document.getElementById("allmap").style.transform = 'scale(1,2)';

		setTimeout("drawMap()", 1000)

	}

	function addMarkerHos(point) {
		var marker = new BMap.Marker(point);
		var myIcon = new BMap.Icon("images/ylss/yiyuancion.png", new BMap.Size(25, 25));
		var mk = new BMap.Marker(point, {
			icon: myIcon
		});
		map.addOverlay(mk);
	}

	function addMarkerDoc(point) {
		var marker = new BMap.Marker(point);
		var myIcon = new BMap.Icon("images/ylss/icon_doctor.png", new BMap.Size(25, 25));
		var mk = new BMap.Marker(point, {
			icon: myIcon
		});
		map.addOverlay(mk);
	}

	function addMarkerYaodian(point) {
		var marker = new BMap.Marker(point);
		var myIcon = new BMap.Icon("images/ylss/yaodianicon.png", new BMap.Size(25, 25));
		var mk = new BMap.Marker(point, {
			icon: myIcon
		});
		map.addOverlay(mk);
	}

	mui.ajax("http://ylss.ss0120.com:8080/ylss/patient/getAroundDoctor.do", {
		data: {
			longitude: localStorage.getItem("longitude"),
			latitude: localStorage.getItem("latitude"),
			phoneNo: "18832078110",
		},
		dataType: 'json',
		type: 'post',
		timeout: 10000,
		success: function(data) {
			if(data.code == 1) {
				var hospInfo = data.doctorInfo;
				var doctorInfo = data.doctorInfo;
				var medicineStoreInfo = data.medicineStoreInfo;
				var message = data.message.toString();
				message=message.split(",").join("</br>");
				
				for(i = 0; i < hospInfo.length; i++) {

					var point = new BMap.Point(hospInfo[i].longitude, hospInfo[i].latitude);
					addMarkerHos(point);
				}
				for(i = 0; i < doctorInfo.length; i++) {

					var point = new BMap.Point(doctorInfo[i].longitude, doctorInfo[i].latitude);
					addMarkerDoc(point);
				}
				for(i = 0; i < medicineStoreInfo.length; i++) {

					var point = new BMap.Point(medicineStoreInfo[i].longitude, medicineStoreInfo[i].latitude);
					addMarkerYaodian(point);
				}
				drawMap(message);
			}

		},
		error: function(xhr, type, errorThrown) {
			mui.toast('网络异常，请稍后再试！');
		}
	});
</script>